# SonarQube Configuration for Robson Bot
#
# This file is OPTIONAL and used ONLY when running SonarQube scanner.
# It does NOT affect local development or pre-commit hooks.
#
# To use:
# 1. Have a running SonarQube server (or SonarCloud)
# 2. Run: sonar-scanner
# 3. View results at your SonarQube server URL
#
# CI Integration (GitHub Actions):
# See .github/workflows/sonarqube.yml (to be created when enabling)
#
# Documentation: docs/quality/README.md

# ==============================================================================
# Project Identification
# ==============================================================================
sonar.projectKey=robson-bot
sonar.organization=rbx-robotica  # For SonarCloud. Remove if using self-hosted SonarQube
sonar.projectName=Robson Bot
sonar.projectVersion=1.0.0

# ==============================================================================
# Code Sources (Multi-Language Monorepo)
# ==============================================================================
sonar.sources=apps/backend,cli,apps/frontend/src
sonar.sourceEncoding=UTF-8

# ==============================================================================
# Python (Django Backend)
# ==============================================================================
sonar.python.version=3.12
sonar.python.coverage.reportPaths=apps/backend/monolith/coverage.xml
sonar.python.xunit.reportPath=apps/backend/monolith/pytest-report.xml

# Python-specific exclusions
sonar.exclusions=apps/backend/**/migrations/**/*.py,apps/backend/**/tests/**/*.py,**/venv/**/*.py,**/.venv/**/*.py

# ==============================================================================
# JavaScript/React (Frontend)
# ==============================================================================
sonar.javascript.lcov.reportPaths=apps/frontend/coverage/lcov.info
sonar.eslint.reportPaths=apps/frontend/eslint-report.json

# Frontend exclusions
sonar.exclusions=apps/frontend/node_modules/**,apps/frontend/dist/**,apps/frontend/build/**

# ==============================================================================
# Go (CLI)
# ==============================================================================
sonar.go.coverage.reportPaths=cli/coverage.out
sonar.go.tests.reportPath=cli/test-report.json

# Go exclusions
sonar.exclusions=cli/vendor/**

# ==============================================================================
# Global Exclusions (Generated, Vendor, Test, Build Artifacts)
# ==============================================================================
sonar.exclusions=\
  **/node_modules/**,\
  **/bower_components/**,\
  **/dist/**,\
  **/build/**,\
  **/target/**,\
  **/venv/**,\
  **/.venv/**,\
  **/virtualenv/**,\
  **/__pycache__/**,\
  **/*.egg-info/**,\
  **/migrations/**,\
  **/tests/**,\
  **/test/**,\
  **/*.test.js,\
  **/*.spec.js,\
  **/*.test.py,\
  **/*.spec.py,\
  **/vendor/**,\
  **/*.min.js,\
  **/*.min.css,\
  **/coverage/**,\
  **/.pytest_cache/**,\
  **/.ruff_cache/**,\
  **/.mypy_cache/**,\
  **/htmlcov/**

# ==============================================================================
# Quality Gate (Optional)
# ==============================================================================
# Relaxed thresholds for initial adoption. Tighten gradually.
sonar.qualitygate.wait=true
sonar.qualitygate.timeout=300

# Coverage thresholds (adjust based on team goals)
sonar.coverage.minimum=0.0  # No minimum initially
# sonar.coverage.minimum=70.0  # Target for future

# New code thresholds (apply to new code only)
sonar.coverage.new.minimum=50.0
sonar.duplication.new.minimum=80.0

# ==============================================================================
# Language-Specific Settings
# ==============================================================================

# Python
sonar.python.pylint.reportPaths=apps/backend/monolith/pylint-report.txt
sonar.python.bandit.reportPaths=apps/backend/monolith/bandit-report.json

# JavaScript
sonar.javascript.environments=browser,node
sonar.typescript.tsconfigPath=apps/frontend/tsconfig.json

# ==============================================================================
# Issue Exclusions (False Positives & Low-Priority Rules)
# ==============================================================================

# Exclude specific rules or patterns
# Format: ruleKey:pattern

# Example: Ignore "too many parameters" in domain models
# sonar.issue.ignore.multicriteria=e1
# sonar.issue.ignore.multicriteria.e1.ruleKey=python:S107
# sonar.issue.ignore.multicriteria.e1.resourceKey=**/domain.py

# Example: Ignore magic numbers in tests
# sonar.issue.ignore.multicriteria=e2
# sonar.issue.ignore.multicriteria.e2.ruleKey=python:S109
# sonar.issue.ignore.multicriteria.e2.resourceKey=**/test_*.py

# ==============================================================================
# SonarCloud-Specific (Remove if using self-hosted SonarQube)
# ==============================================================================
# sonar.host.url=https://sonarcloud.io
# sonar.login=YOUR_SONARCLOUD_TOKEN  # Set via environment variable: SONAR_TOKEN

# ==============================================================================
# Self-Hosted SonarQube (Uncomment if using self-hosted instance)
# ==============================================================================
# sonar.host.url=http://your-sonarqube-server:9000
# sonar.login=YOUR_SONARQUBE_TOKEN  # Set via environment variable: SONAR_TOKEN

# ==============================================================================
# Notes
# ==============================================================================
#
# Running the Scanner:
#
#   Local (for testing):
#     export SONAR_TOKEN=your-token
#     sonar-scanner
#
#   CI (GitHub Actions):
#     - name: SonarQube Scan
#       uses: sonarsource/sonarqube-scan-action@master
#       env:
#         SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
#         SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
#
# Requirements:
#   - Install sonar-scanner: https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/
#   - Generate test coverage reports first (pytest, vitest, go test)
#   - Set SONAR_TOKEN environment variable
#
# Troubleshooting:
#   - "Project not found": Create project in SonarQube UI first
#   - "Permission denied": Check SONAR_TOKEN has "Execute Analysis" permission
#   - "No coverage report": Run tests with coverage enabled first
#
# ==============================================================================
