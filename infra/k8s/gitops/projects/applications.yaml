apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: rbx-applications
  namespace: argocd
  labels:
    rbx.env: production
    rbx.product: platform
    rbx.agent_id: human
    rbx.change_id: CHANGE_ID_PLACEHOLDER
    app.kubernetes.io/part-of: rbx-systems
spec:
  description: >
    Product applications for RBX Systems. Includes robson, strategos,
    thalamus, and shared infrastructure apps like DNS.

  # Allowed source repositories
  sourceRepos:
    - https://github.com/ldamasio/robson
    - https://github.com/ldamasio/robson.git

  # Allowed destination clusters and namespaces
  destinations:
    - server: https://kubernetes.default.svc
      namespace: robson
    - server: https://kubernetes.default.svc
      namespace: robson-staging
    - server: https://kubernetes.default.svc
      namespace: dns
    - server: https://kubernetes.default.svc
      namespace: strategos
    - server: https://kubernetes.default.svc
      namespace: thalamus

  # No cluster-scoped resources for product apps
  clusterResourceWhitelist: []

  # Namespace-scoped resources (allow all within permitted namespaces)
  namespaceResourceWhitelist:
    - group: "*"
      kind: "*"

  # Deny cluster-scoped resources explicitly
  clusterResourceBlacklist:
    - group: "*"
      kind: Namespace

  # Roles for future RBAC integration
  roles:
    - name: app-admin
      description: Full access to application deployments
      policies:
        - p, proj:rbx-applications:app-admin, applications, *, rbx-applications/*, allow
      groups:
        - developers
    - name: app-viewer
      description: Read-only access to application deployments
      policies:
        - p, proj:rbx-applications:app-viewer, applications, get, rbx-applications/*, allow
      groups:
        - viewers
